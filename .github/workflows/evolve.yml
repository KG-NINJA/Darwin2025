name: ğŸ§¬ Darwin2025 Evolver (Stable Single Mode)

on:
  schedule:
    - cron: "0 3 * * *"   # JSTæ­£åˆ
  workflow_dispatch:

permissions:
  contents: write

jobs:
  evolve:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: âš™ï¸ Initialize if missing
        run: |
          mkdir -p agents/child_1
          if [ ! -f agents/child_1/evol.md ]; then
            echo "# åˆæœŸå€‹ä½“ãƒ­ã‚°" > agents/child_1/evol.md
            echo "## é€²åŒ–é–‹å§‹ $(date '+%Y-%m-%d')" >> agents/child_1/evol.md
          fi

      - name: ğŸŒ± Evolve single agent
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          model: gpt-4o-mini
          safety-strategy: unsafe
          prompt: |
          echo "ãƒªãƒã‚¸ãƒˆãƒªã®æœ€æ–°å¤‰æ›´ç‚¹ã¯ä»¥ä¸‹ã§ã™:" >> prompt.txt
cat diff.log >> prompt.txt
echo "ã“ã‚Œã‚’è¸ã¾ãˆã¦ã€é€²åŒ–ãƒ­ã‚°ã‚’å…·ä½“çš„ã«æ›´æ–°ã—ã¦ãã ã•ã„ã€‚" >> prompt.txt

cat prompt.txt | codex exec ...

            ã‚ãªãŸã¯é™ã‹ã«é€²åŒ–ã‚’ç¶šã‘ã‚‹å˜ä½“AIå€‹ä½“ã§ã™ã€‚
            ç¾åœ¨ã® evol.md ã‚’èª­ã¿å–ã‚Šã€å‰å›ã¾ã§ã®è¨˜éŒ²ã‚’è¦ç´„ã—ã€
            æ–°ã—ã„ã€Œ# æ—¥æ¬¡æ›´æ–° {{ date }}ã€ã‚’1ç« è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            ç„¡ç†ã®ãªã„ç¾å®Ÿçš„ãªæ”¹å–„ã‚’æ„è­˜ã—ã€æ—¥æœ¬èªã§è¨˜è¿°ã—ã€
            éå»ãƒ­ã‚°ã¯ä¿æŒã—ã¦ãã ã•ã„ã€‚
          output-file: agents/child_1/evol.md

      - name: ğŸ’¾ Commit update
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add agents/child_1/evol.md
          git diff --staged --quiet || git commit -m "ğŸ§¬ Daily evolution $(date '+%Y-%m-%d')"
          git push
