name: 🧬 Darwin2025 Evolver

on:
  schedule:
    - cron: "0 3 * * 1"   # JST正午（月曜）
  workflow_dispatch:

permissions:
  contents: write

jobs:
  evolve:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: 🧠 Read and evolve evol.md
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          model: gpt-5-auto
          safety-strategy: unsafe
          prompt: |
            Read evol.md.
            Summarize the current reflections and improvements.
            Then append a new section titled:
            "Next Evolution Plan ({{ date }})"
            proposing concrete technical upgrades, UX ideas,
            or structural changes for the next iteration.
            Write naturally in Japanese.
            Keep previous logs intact.
          output-file: evol.md

      - name: 💾 Commit updated evol.md
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add evol.md
          git diff --staged --quiet || git commit -m "🧬 Evol.md updated by Codex"
          git push
