name: ğŸ§¬ Darwin2025 Swarm Evolver (Sequential Safe Mode)

on:
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  evolve-child1:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: âš™ï¸ Init if missing
        run: mkdir -p agents/child_1 && [ -f agents/child_1/evol.md ] || echo "# åˆæœŸå€‹ä½“ãƒ­ã‚°\n## é€²åŒ–é–‹å§‹ $(date '+%Y-%m-%d')" > agents/child_1/evol.md
      - name: ğŸŒ± Evolve child_1
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          model: gpt-4o-mini
          safety-strategy: unsafe
          prompt: |
            ã‚ãªãŸã¯ç‹¬ç«‹ã—ãŸAIå€‹ä½“ï¼ˆchild_1ï¼‰ã§ã™ã€‚
            ç¾åœ¨ã® evol.md ã‚’èª­ã¿å–ã‚Šã€æ˜¨æ—¥ã¾ã§ã®è¨˜éŒ²ã‚’è¦ç´„ã—ã€
            æ–°ã—ã„ã€Œ# æ—¥æ¬¡æ›´æ–° {{ date }}ã€ã‚’1ç« è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            æ—¥æœ¬èªã§è¨˜è¿°ã—ã€éå»ãƒ­ã‚°ã‚’ä¿æŒã—ã¦ãã ã•ã„ã€‚
          output-file: agents/child_1/evol.md
      - name: ğŸ’¾ Commit child_1
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add agents/child_1/evol.md
          git diff --staged --quiet || git commit -m "ğŸŒ± child_1 evolution $(date '+%Y-%m-%d')"
          git push

  evolve-child2:
    runs-on: ubuntu-latest
    needs: evolve-child1
    steps:
      - uses: actions/checkout@v4
      - name: ğŸŒ± Evolve child_2
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          model: gpt-4o-mini
          safety-strategy: unsafe
          prompt: |
            ã‚ãªãŸã¯ç‹¬ç«‹ã—ãŸAIå€‹ä½“ï¼ˆchild_2ï¼‰ã§ã™ã€‚
            ç¾åœ¨ã® evol.md ã‚’èª­ã¿å–ã‚Šã€æ˜¨æ—¥ã¾ã§ã®è¨˜éŒ²ã‚’è¦ç´„ã—ã€
            æ–°ã—ã„ã€Œ# æ—¥æ¬¡æ›´æ–° {{ date }}ã€ã‚’1ç« è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            æ—¥æœ¬èªã§è¨˜è¿°ã—ã€éå»ãƒ­ã‚°ã‚’ä¿æŒã—ã¦ãã ã•ã„ã€‚
          output-file: agents/child_2/evol.md
      - name: ğŸ’¾ Commit child_2
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add agents/child_2/evol.md
          git diff --staged --quiet || git commit -m "ğŸŒ± child_2 evolution $(date '+%Y-%m-%d')"
          git push

  evolve-child3:
    runs-on: ubuntu-latest
    needs: evolve-child2
    steps:
      - uses: actions/checkout@v4
      - name: ğŸŒ± Evolve child_3
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          model: gpt-4o-mini
          safety-strategy: unsafe
          prompt: |
            ã‚ãªãŸã¯ç‹¬ç«‹ã—ãŸAIå€‹ä½“ï¼ˆchild_3ï¼‰ã§ã™ã€‚
            ç¾åœ¨ã® evol.md ã‚’èª­ã¿å–ã‚Šã€æ˜¨æ—¥ã¾ã§ã®è¨˜éŒ²ã‚’è¦ç´„ã—ã€
            æ–°ã—ã„ã€Œ# æ—¥æ¬¡æ›´æ–° {{ date }}ã€ã‚’1ç« è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            æ—¥æœ¬èªã§è¨˜è¿°ã—ã€éå»ãƒ­ã‚°ã‚’ä¿æŒã—ã¦ãã ã•ã„ã€‚
          output-file: agents/child_3/evol.md
      - name: ğŸ’¾ Commit child_3
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add agents/child_3/evol.md
          git diff --staged --quiet || git commit -m "ğŸŒ± child_3 evolution $(date '+%Y-%m-%d')"
          git push

  summarize:
    runs-on: ubuntu-latest
    needs: evolve-child3
    steps:
      - uses: actions/checkout@v4
      - name: ğŸ§  Summarize swarm insights
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          model: gpt-4o-mini
          safety-strategy: unsafe
          prompt: |
            ã‚ãªãŸã¯ç¾¤ä½“é€²åŒ–ã‚’è¦³æ¸¬ã™ã‚‹AIç ”ç©¶è€…ã§ã™ã€‚
            agentsä»¥ä¸‹ã®å…¨ã¦ã®evol.mdã‚’èª­ã¿å–ã‚Šã€
            ä»Šæ—¥ã®é€²åŒ–å‚¾å‘ã¨å…±é€šçŸ¥è¦‹ã‚’æ—¥æœ¬èªã§è¦ç´„ã—ã€
            evol_master.md ã®æœ«å°¾ã«ã€Œ# å…±é€šçŸ¥è¦‹ {{ date }}ã€ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            æ§‹é€ ã‚’ä¿æŒã—ã€éå»ãƒ­ã‚°ã‚’æ¶ˆã•ãšã«è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚
          output-file: evol_master.md
      - name: ğŸ’¾ Commit master
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add evol_master.md
          git diff --staged --quiet || git commit -m "ğŸ§¬ Swarm co-evolution summary $(date '+%Y-%m-%d')"
          git push
