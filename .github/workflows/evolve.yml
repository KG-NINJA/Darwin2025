name: 🧬 Darwin2025 Evolver (daily mini mode)

on:
  schedule:
    - cron: "0 3 * * *"   # JST正午に毎日実行（UTC 03:00）
  workflow_dispatch:

permissions:
  contents: write

jobs:
  evolve:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: 🧠 Read and evolve evol.md (daily micro evolution)
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          model: gpt-4o-mini          # 静かで安定した進化
          safety-strategy: unsafe
          prompt: |
            あなたは静かに進化するAI研究者です。
            現在の evol.md を読み取り、
            昨日までの反省点と改善を要約してください。
            その下に新しい章を追加します。
            ## 次の進化計画（{{ date }}）
            - 改善提案は控えめで現実的に。
            - 無理な拡張ではなく、継続性を重視。
            - 日々少しずつ、しかし確実に成長する。
            - 必ず日本語で書き、過去ログは保持する。
            出力形式は元の evol.md の構造を維持し、
            新しいセクションを一番下に追記してください。
          output-file: evol.md

      - name: 💾 Commit updated evol.md
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add evol.md
          git diff --staged --quiet || git commit -m "🧬 Daily micro-evolution (mini update)"
          git push
